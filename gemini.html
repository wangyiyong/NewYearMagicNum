<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 è·¨å¹´æµªæ¼«å€’è®¡æ—¶</title>
    <style>
        /* --- å…¨å±€æ ·å¼ & å­—ä½“ --- */
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@800&family=Noto+Serif+SC:wght@700&display=swap');

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #020010; /* æ·±ç©ºè“é»‘ */
            font-family: 'Montserrat', 'Noto Serif SC', sans-serif;
        }

        /* æå…‰èƒŒæ™¯ */
        .aurora-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 100%, #1a0b2e, #000000);
            z-index: 0;
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
            pointer-events: none; /* è®©é¼ æ ‡äº‹ä»¶ç©¿é€ canvas */
        }

        /* UI å±‚çº§ */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            pointer-events: auto;
        }

        /* --- é˜¶æ®µä¸€ï¼šç›¸æœºä¸é€‰æ‹© --- */
        .camera-container {
            text-align: center;
            opacity: 0;
            transition: opacity 1s;
        }
        
        .polaroid-cam {
            width: 200px;
            height: 180px;
            background: #fdfdfd;
            border-radius: 20px;
            box-shadow: 0 0 50px rgba(255,215,0, 0.3);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            cursor: pointer;
            position: relative;
            animation: float 3s ease-in-out infinite;
        }

        .lens {
            width: 100px;
            height: 100px;
            background: #222;
            border-radius: 50%;
            border: 5px solid #ccc;
            position: relative;
            overflow: hidden;
        }
        
        .lens::after {
            content: '';
            position: absolute;
            top: 20px;
            right: 20px;
            width: 20px;
            height: 20px;
            background: rgba(255,255,255,0.4);
            border-radius: 50%;
        }

        .flash-btn {
            width: 30px;
            height: 30px;
            background: #ff4757;
            border-radius: 50%;
            position: absolute;
            top: -15px;
            right: 20px;
            border: 3px solid #fff;
        }

        .cam-text {
            color: #fff;
            margin-top: 20px;
            font-size: 1.2rem;
            text-shadow: 0 0 10px rgba(255,255,255,0.5);
        }

        #file-input {
            display: none;
        }

        /* é—ªå…‰ç¯æ•ˆæœ */
        .flash-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: white;
            opacity: 0;
            pointer-events: none;
            z-index: 100;
            transition: opacity 0.1s;
        }

        /* --- é˜¶æ®µä¸‰ï¼šçº¢åŒ…å¡ç‰‡ --- */
        .card-modal {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0);
            width: 300px;
            background: #fff0f0;
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(255,0,0,0.5);
            z-index: 50;
            padding: 20px;
            text-align: center;
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 2px solid #ffd700;
        }

        .card-modal.show {
            transform: translate(-50%, -50%) scale(1);
        }

        .card-img {
            width: 100%;
            height: 220px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 5px solid white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .card-wish {
            font-size: 1.1rem;
            color: #d63031;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .close-btn {
            background: #ff4757;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        /* æç¤ºæ–‡å­— */
        .instruction {
            position: absolute;
            bottom: 50px;
            color: rgba(255,255,255,0.6);
            font-size: 0.9rem;
            pointer-events: none;
        }
    </style>
</head>
<body>

    <div class="aurora-bg"></div>
    <canvas id="mainCanvas"></canvas>
    <div class="flash-overlay" id="flash"></div>

    <div id="ui-layer">
        
        <div class="camera-container" id="stage1">
            <label for="file-input">
                <div class="polaroid-cam">
                    <div class="flash-btn"></div>
                    <div class="lens"></div>
                </div>
            </label>
            <div class="cam-text">ç‚¹å‡»ç›¸æœºç”Ÿæˆä½ çš„2025å›å¿†</div>
            <div class="cam-text" style="font-size: 0.8rem; opacity: 0.7;">(é€‰æ‹© 5-10 å¼ ç…§ç‰‡)</div>
            <input type="file" id="file-input" multiple accept="image/*">
        </div>

        <div class="card-modal" id="cardModal">
            <img src="" alt="Memory" class="card-img" id="modalImg">
            <div class="card-wish" id="modalWish"></div>
            <button class="close-btn" onclick="closeCard()">æ”¶ä¸‹ç¥ç¦</button>
        </div>
        
        <div class="instruction" id="instruction"></div>
    </div>

<script>
/**
 * 2026 è·¨å¹´å€’è®¡æ—¶é€»è¾‘æ ¸å¿ƒ
 * åŒ…å«ï¼šç²’å­ç³»ç»Ÿã€çƒŸèŠ±ç³»ç»Ÿã€çŠ¶æ€ç®¡ç†
 */

// --- é…ç½®ä¸èµ„æº ---
const WISHES = [
    "2026ï¼Œæ„¿ä½ çš„bugéƒ½å˜æˆfeatureï¼Œå¤´å‘å’Œè´¢å¯Œä¸€æ ·æµ“å¯†ï¼",
    "å‰è·¯æµ©æµ©è¡è¡ï¼Œä¸‡äº‹å°½å¯æœŸå¾…ã€‚2026ï¼Œèµ·é£ï¼",
    "æ‰€æ±‚çš†å¦‚æ„¿ï¼Œæ‰€è¡ŒåŒ–å¦é€”ã€‚æ–°å¹´å¿«ä¹ï¼",
    "æ‰€æœ‰çš„é—æ†¾éƒ½æ˜¯2026æƒŠå–œçš„é“ºå«ã€‚",
    "å‡¡æ˜¯è¿‡å¾€ï¼Œçš†ä¸ºåºç« ã€‚2026ï¼Œè¯·å¤šæŒ‡æ•™ã€‚",
    "æ„¿ä½ ä¿æŒçƒ­çˆ±ï¼Œå¥”èµ´å±±æµ·ã€‚",
    "æ‹’ç»å†…è€—ï¼Œå‘è´¢è¦ç´§ï¼2026å†²é¸­ï¼",
    "çƒŸç«å‘æ˜Ÿè¾°ï¼Œæ‰€æ„¿çš†æˆçœŸã€‚"
];

let userPhotos = []; // å­˜å‚¨ç”¨æˆ·ä¸Šä¼ çš„ç…§ç‰‡DataURL

// --- Canvas è®¾ç½® ---
const canvas = document.getElementById('mainCanvas');
const ctx = canvas.getContext('2d');
let w, h;

function resize() {
    w = canvas.width = window.innerWidth;
    h = canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

// --- å·¥å…·å‡½æ•° ---
const random = (min, max) => Math.random() * (max - min) + min;
const randomInt = (min, max) => Math.floor(random(min, max));

// --- ç²’å­æ–‡å­—ç³»ç»Ÿ (Countdown & 2026) ---
class Particle {
    constructor(x, y, color) {
        this.x = Math.random() * w;
        this.y = Math.random() * h;
        this.destX = x;
        this.destY = y;
        this.vx = (Math.random() - 0.5) * 10;
        this.vy = (Math.random() - 0.5) * 10;
        this.accX = 0;
        this.accY = 0;
        this.friction = 0.95; // æ‘©æ“¦åŠ›
        this.color = color || `hsl(${random(30, 60)}, 100%, 50%)`; // é‡‘è‰²ç³»
        this.size = random(2, 4);
    }

    update() {
        this.accX = (this.destX - this.x) / 20; // å¼¹ç°§æ‹‰åŠ›
        this.accY = (this.destY - this.y) / 20;
        this.vx += this.accX;
        this.vy += this.accY;
        this.vx *= this.friction;
        this.vy *= this.friction;
        this.x += this.vx;
        this.y += this.vy;
    }

    draw() {
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();
    }
}

let textParticles = [];

function createTextParticles(text, fontSize = 200) {
    textParticles = [];
    // ä½¿ç”¨ç¦»å± Canvas è·å–æ–‡å­—åƒç´ 
    const offCanvas = document.createElement('canvas');
    offCanvas.width = w;
    offCanvas.height = h;
    const offCtx = offCanvas.getContext('2d');
    
    offCtx.fillStyle = '#fff';
    offCtx.font = `900 ${fontSize}px Montserrat`;
    offCtx.textAlign = 'center';
    offCtx.textBaseline = 'middle';
    offCtx.fillText(text, w / 2, h / 2);

    const data = offCtx.getImageData(0, 0, w, h).data;
    const gap = 8; // é‡‡æ ·é—´éš”ï¼Œè¶Šå°ç²’å­è¶Šå¤šï¼ˆæ€§èƒ½æ¶ˆè€—è¶Šå¤§ï¼‰

    for (let y = 0; y < h; y += gap) {
        for (let x = 0; x < w; x += gap) {
            const alpha = data[(y * w + x) * 4 + 3];
            if (alpha > 128) {
                textParticles.push(new Particle(x, y));
            }
        }
    }
}

// --- çƒŸèŠ±ç³»ç»Ÿ ---
class Firework {
    constructor() {
        this.x = random(w * 0.1, w * 0.9);
        this.y = h;
        this.targetY = random(h * 0.1, h * 0.4);
        this.speed = random(5, 10);
        this.angle = -Math.PI / 2 + (Math.random() - 0.5) * 0.2;
        this.vx = Math.cos(this.angle) * this.speed;
        this.vy = Math.sin(this.angle) * this.speed;
        this.hue = random(0, 360);
        this.dead = false;
        this.particles = [];
    }

    update() {
        this.x += this.vx;
        this.y += this.vy;
        this.vy += 0.05; // é‡åŠ›

        if (this.vy >= 0 || this.y <= this.targetY) {
            this.explode();
            this.dead = true;
        }
    }

    explode() {
        for (let i = 0; i < 80; i++) {
            this.particles.push(new FireworkParticle(this.x, this.y, this.hue));
        }
    }

    draw() {
        if (!this.dead) {
            ctx.fillStyle = `hsl(${this.hue}, 100%, 50%)`;
            ctx.beginPath();
            ctx.arc(this.x, this.y, 3, 0, Math.PI * 2);
            ctx.fill();
        }
        this.particles.forEach((p, index) => {
            p.update();
            p.draw();
            if (p.alpha <= 0) this.particles.splice(index, 1);
        });
    }
}

class FireworkParticle {
    constructor(x, y, hue) {
        this.x = x;
        this.y = y;
        const angle = random(0, Math.PI * 2);
        const speed = random(1, 6);
        this.vx = Math.cos(angle) * speed;
        this.vy = Math.sin(angle) * speed;
        this.hue = hue;
        this.alpha = 1;
        this.decay = random(0.01, 0.03);
        this.gravity = 0.1;
    }
    update() {
        this.x += this.vx;
        this.y += this.vy;
        this.vy += this.gravity;
        this.alpha -= this.decay;
    }
    draw() {
        ctx.save();
        ctx.globalAlpha = this.alpha;
        ctx.fillStyle = `hsl(${this.hue}, 100%, 60%)`;
        ctx.beginPath();
        ctx.arc(this.x, this.y, 2, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
    }
}

let fireworks = [];

// --- çº¢åŒ…ç³»ç»Ÿ ---
class RedEnvelope {
    constructor() {
        this.x = random(0, w);
        this.y = -50;
        this.w = 40;
        this.h = 60;
        this.vy = random(2, 5);
        this.rotation = random(0, 360);
        this.rotSpeed = random(-2, 2);
        this.dead = false;
    }

    update() {
        this.y += this.vy;
        this.rotation += this.rotSpeed;
        if (this.y > h + 50) this.dead = true;
    }

    draw() {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.rotation * Math.PI / 180);
        
        // ç»˜åˆ¶ç®€å•çº¢åŒ…
        ctx.fillStyle = '#d63031';
        ctx.fillRect(-this.w/2, -this.h/2, this.w, this.h);
        ctx.fillStyle = '#fdcb6e'; // é‡‘è‰²å°å£
        ctx.fillRect(-this.w/2, -this.h/4, this.w, 10);
        ctx.fillStyle = '#ffeaa7';
        ctx.font = '20px Arial';
        ctx.fillText('ç¦', -10, 10);
        
        ctx.restore();
    }
    
    // ç®€å•çš„ç¢°æ’æ£€æµ‹
    isClicked(mx, my) {
        return (mx > this.x - 30 && mx < this.x + 30 && my > this.y - 40 && my < this.y + 40);
    }
}

let envelopes = [];

// --- æµç¨‹æ§åˆ¶ ---
let currentStage = 0; // 0: Photo, 1: Countdown, 2: 2026 Celebration, 3: Envelope Interaction
let countdownValue = 10;
let lastTime = 0;

function init() {
    // å¯åŠ¨åŠ¨ç”»å¾ªç¯
    requestAnimationFrame(loop);
    
    // æ˜¾ç¤ºç¬¬ä¸€é˜¶æ®µ UI
    const stage1UI = document.getElementById('stage1');
    stage1UI.style.opacity = 1;
}

// ç›‘å¬æ–‡ä»¶ä¸Šä¼ 
document.getElementById('file-input').addEventListener('change', function(e) {
    if (this.files && this.files.length > 0) {
        const files = Array.from(this.files);
        // è¯»å–å›¾ç‰‡
        let loadedCount = 0;
        files.slice(0, 10).forEach(file => {
            const reader = new FileReader();
            reader.onload = (evt) => {
                userPhotos.push(evt.target.result);
                loadedCount++;
                if (loadedCount === Math.min(files.length, 10)) {
                    startCountdownStage();
                }
            };
            reader.readAsDataURL(file);
        });
    }
});

function startCountdownStage() {
    // é—ªå…‰ç¯æ•ˆæœ
    const flash = document.getElementById('flash');
    flash.style.opacity = 1;
    setTimeout(() => { flash.style.opacity = 0; }, 100);

    // éšè— UI 1
    document.getElementById('stage1').style.display = 'none';
    
    currentStage = 1;
    startCountdownLogic();
}

function startCountdownLogic() {
    createTextParticles(countdownValue.toString());
    
    const interval = setInterval(() => {
        countdownValue--;
        if (countdownValue > 0) {
            createTextParticles(countdownValue.toString());
        } else {
            clearInterval(interval);
            startCelebrationStage();
        }
    }, 1000);
}

function startCelebrationStage() {
    currentStage = 2;
    createTextParticles("2026", 150); // å±•ç¤º2026
    
    // 5ç§’åè¿›å…¥çº¢åŒ…é˜¶æ®µ
    setTimeout(() => {
        currentStage = 3;
        textParticles = []; // æ¸…é™¤æ–‡å­—
        document.getElementById('instruction').innerText = "ğŸ– å…¨å±çº¢åŒ…é›¨æ¥è¢­ï¼ç‚¹å‡»(æŠ“å–)ä»»æ„çº¢åŒ…æ‰“å¼€æƒŠå–œï¼";
        
        // ç‚¹å‡»äº‹ä»¶ç›‘å¬çº¢åŒ…
        window.addEventListener('click', handleEnvelopeClick);
        window.addEventListener('touchstart', (e) => handleEnvelopeClick(e.touches[0]));
    }, 5000);
}

function handleEnvelopeClick(e) {
    if (currentStage !== 3) return;
    const mx = e.clientX;
    const my = e.clientY;

    // å€’åºæ£€æŸ¥ï¼Œä¼˜å…ˆç‚¹å‡»ä¸Šå±‚
    for (let i = envelopes.length - 1; i >= 0; i--) {
        if (envelopes[i].isClicked(mx, my)) {
            openEnvelope(envelopes[i].x, envelopes[i].y);
            envelopes.splice(i, 1);
            break; // ä¸€æ¬¡åªç‚¹ä¸€ä¸ª
        }
    }
}

function openEnvelope(x, y) {
    // çˆ†ç‚¸çƒŸèŠ±
    for(let k=0; k<5; k++) fireworks.push(new Firework()); // å¢åŠ å–œåº†æ°”æ°›
    
    // æ˜¾ç¤ºå¡ç‰‡ Modal
    const modal = document.getElementById('cardModal');
    const img = document.getElementById('modalImg');
    const wish = document.getElementById('modalWish');
    
    // éšæœºé€‰ä¸€å¼ ç”¨æˆ·å›¾ï¼ˆå¦‚æœæ²¡æœ‰åˆ™ç”¨å ä½å›¾ï¼‰
    if (userPhotos.length > 0) {
        img.src = userPhotos[randomInt(0, userPhotos.length)];
    } else {
        img.src = "https://picsum.photos/300/220"; // å…œåº•å›¾
    }
    
    wish.innerText = WISHES[randomInt(0, WISHES.length)];
    modal.classList.add('show');
}

window.closeCard = function() {
    document.getElementById('cardModal').classList.remove('show');
}

// --- ä¸»å¾ªç¯ ---
function loop() {
    // èƒŒæ™¯æ¸…é™¤ï¼ˆä¿ç•™æ‹–å°¾æ•ˆæœï¼‰
    ctx.fillStyle = 'rgba(2, 0, 16, 0.2)';
    ctx.fillRect(0, 0, w, h);

    // é˜¶æ®µé€»è¾‘
    if (currentStage === 1 || currentStage === 2) {
        // ç²’å­æ–‡å­—
        textParticles.forEach(p => {
            p.update();
            p.draw();
        });
    }

    if (currentStage === 2 || currentStage === 3) {
        // çƒŸèŠ±è‡ªåŠ¨å‘å°„ (åº†ç¥é˜¶æ®µ)
        if (Math.random() < 0.05) {
            fireworks.push(new Firework());
        }
    }
    
    // ç»˜åˆ¶çƒŸèŠ±
    fireworks.forEach((fw, index) => {
        fw.update();
        fw.draw();
        if (fw.dead && fw.particles.length === 0) fireworks.splice(index, 1);
    });

    if (currentStage === 3) {
        // ç”Ÿæˆçº¢åŒ…é›¨
        if (Math.random() < 0.1) {
            envelopes.push(new RedEnvelope());
        }
        envelopes.forEach((env, index) => {
            env.update();
            env.draw();
            if (env.dead) envelopes.splice(index, 1);
        });
    }
    
    // æµæ˜Ÿ (å…¨é˜¶æ®µå¶å°”å‡ºç°)
    if (Math.random() < 0.01) {
        drawMeteor();
    }

    requestAnimationFrame(loop);
}

// ç®€å•çš„æµæ˜Ÿç»˜åˆ¶
function drawMeteor() {
    const sx = random(0, w);
    const sy = 0;
    const len = random(100, 300);
    ctx.strokeStyle = 'rgba(255,255,255,0.8)';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(sx, sy);
    ctx.lineTo(sx - len, sy + len);
    ctx.stroke();
}

// å¯åŠ¨
init();

</script>
</body>
</html>