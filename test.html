<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>2026 跨年浪漫倒计时</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html,body{
  margin:0;
  padding:0;
  background:#000;
  overflow:hidden;
}
canvas{
  position:fixed;
  top:0;
  left:0;
}
#camera{ /* 拍立得 */
  position:absolute;
  top:50%;
  left:50%;
  width:200px;
  transform:translate(-50%,-50%);
  cursor:pointer;
  animation: float 3s ease-in-out infinite;
  z-index:10;
}
@keyframes float{
  0%,100%{transform:translate(-50%,-48%)}
  50%{transform:translate(-50%,-52%)}
}
.polaroid{
  position:absolute;
  width:120px;
  background:#fff;
  padding:8px 8px 24px;
  box-shadow:0 15px 40px rgba(0,0,0,.6);
}
.polaroid img{width:100%}
#file{display:none}
</style>
</head>
<body>

<canvas id="bg"></canvas>
<canvas id="effect"></canvas>

<!-- 拍立得 -->
<svg id="camera" viewBox="0 0 200 160">
  <rect x="10" y="40" rx="15" width="180" height="110" fill="#f5f5f5"/>
  <rect x="60" y="10" width="80" height="40" rx="10" fill="#ddd"/>
  <circle cx="100" cy="95" r="35" fill="#222"/>
  <circle cx="100" cy="95" r="20" fill="#444"/>
</svg>

<input id="file" type="file" multiple accept="image/*">

<script>
/* ======================
   全局状态
====================== */
let stage = 1;
let photos = [];
let photoCount = 0;

/* ======================
   Canvas 初始化
====================== */
const bg = document.getElementById('bg');
const ctx = bg.getContext('2d');
const fx = document.getElementById('effect');
const fctx = fx.getContext('2d');

resize();
window.onresize = resize;
function resize(){
  bg.width = fx.width = innerWidth;
  bg.height = fx.height = innerHeight;
}

/* ======================
   星空 / 北极光 / 流星（同前）
====================== */
const stars=[];
for(let i=0;i<250;i++){
  stars.push({
    x:Math.random()*bg.width,
    y:Math.random()*bg.height,
    r:Math.random()*1.5,
    a:Math.random()*Math.PI*2,
    s:Math.random()*0.02+0.005
  });
}
let auroraOffset=0;
const meteors=[];
function createMeteor(){
  meteors.push({
    x:Math.random()*bg.width,
    y:Math.random()*bg.height*0.5,
    vx:-8-Math.random()*4,
    vy:6+Math.random()*3,
    life:80
  });
}

function animateBg(){
  ctx.clearRect(0,0,bg.width,bg.height);
  drawBackground();
  drawAurora();
  drawStars();
  drawMeteors();
  requestAnimationFrame(animateBg);
}
animateBg();

function drawBackground(){
  const g=ctx.createLinearGradient(0,0,0,bg.height);
  g.addColorStop(0,'#020111');
  g.addColorStop(1,'#000');
  ctx.fillStyle=g;
  ctx.fillRect(0,0,bg.width,bg.height);
}
function drawStars(){
  stars.forEach(s=>{
    s.a+=s.s;
    ctx.fillStyle=`rgba(255,255,255,${0.4+Math.sin(s.a)*0.4})`;
    ctx.beginPath();
    ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    ctx.fill();
  });
}
function drawAurora(){
  auroraOffset+=0.003;
  for(let i=0;i<3;i++){
    const y=bg.height*0.2+i*80;
    const g=ctx.createLinearGradient(0,y,0,y+200);
    g.addColorStop(0,'rgba(0,255,200,.08)');
    g.addColorStop(.5,'rgba(0,150,255,.12)');
    g.addColorStop(1,'rgba(0,0,0,0)');
    ctx.fillStyle=g;
    ctx.beginPath();
    ctx.moveTo(0,y);
    for(let x=0;x<=bg.width;x+=20){
      ctx.lineTo(x,y+Math.sin(x*0.01+auroraOffset+i)*30);
    }
    ctx.lineTo(bg.width,bg.height);
    ctx.lineTo(0,bg.height);
    ctx.fill();
  }
}
function drawMeteors(){
  if(Math.random()<0.01) createMeteor();
  for(let i=meteors.length-1;i>=0;i--){
    const m=meteors[i];
    m.x+=m.vx;
    m.y+=m.vy;
    m.life--;
    ctx.strokeStyle='rgba(255,255,255,.8)';
    ctx.beginPath();
    ctx.moveTo(m.x,m.y);
    ctx.lineTo(m.x-m.vx*4,m.y-m.vy*4);
    ctx.stroke();
    if(m.life<=0) meteors.splice(i,1);
  }
}

/* ======================
   拍立得 & 回忆漂浮（略，保持）
====================== */
const camera=document.getElementById('camera');
const file=document.getElementById('file');
camera.onclick=()=>file.click();

file.onchange=e=>{
  [...e.target.files].slice(0,10).forEach(f=>{
    const img=new Image();
    img.onload=()=>{
      const d=document.createElement('div');
      d.className='polaroid';
      d.style.left='50%';
      d.style.top='50%';
      d.style.transform=`translate(-50%,-50%) rotate(${Math.random()*40-20}deg)`;
      d.appendChild(img);
      document.body.appendChild(d);
      photos.push({el:d,y:innerHeight/2,opacity:1});
      photoCount++;
      if(photoCount>=5){
        setTimeout(startCountdown,3000);
      }
    };
    img.src=URL.createObjectURL(f);
  });
};

/* ======================
   第 3 阶段：粒子倒计时
====================== */
const off=document.createElement('canvas');
const offCtx=off.getContext('2d');
let particles=[];
let count=10;

function startCountdown(){
  stage=3;
  camera.remove();
  photos.forEach(p=>p.el.remove());
  countdownLoop();
}

function drawNumber(num){
  off.width=fx.width;
  off.height=fx.height;
  offCtx.clearRect(0,0,off.width,off.height);
  offCtx.fillStyle='#fff';
  offCtx.font='bold 240px sans-serif';
  offCtx.textAlign='center';
  offCtx.textBaseline='middle';
  offCtx.fillText(num,off.width/2,off.height/2);
  const img=offCtx.getImageData(0,0,off.width,off.height).data;
  particles=[];
  for(let y=0;y<off.height;y+=6){
    for(let x=0;x<off.width;x+=6){
      const i=(y*off.width+x)*4;
      if(img[i+3]>128){
        particles.push({
          x,y,
          vx:(Math.random()-0.5)*2,
          vy:(Math.random()-0.5)*2,
          life:100
        });
      }
    }
  }
}

function countdownLoop(){
  drawNumber(count);
  const interval=setInterval(()=>{
    fctx.clearRect(0,0,fx.width,fx.height);
    particles.forEach(p=>{
      p.x+=p.vx;
      p.y+=p.vy;
      p.life--;
      fctx.fillStyle=`rgba(255,215,0,${p.life/100})`;
      fctx.fillRect(p.x,p.y,2,2);
    });
  },16);

  setTimeout(()=>{
    clearInterval(interval);
    count--;
    if(count>0){
      countdownLoop();
    }else{
      stage=4;
      // 下一次：烟火爆发
    }
  },900);
}
</script>
</body>
</html>
